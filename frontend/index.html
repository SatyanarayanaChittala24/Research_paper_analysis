<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research RAG Assistant</title>
    <style>
        /* CSS - Making it look good */
        body { font-family: Arial, sans-serif; background-color: #282c34; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        h1 { margin-top: 20px; }
        
        .container { width: 90%; max-width: 800px; text-align: center; }
        
        /* Upload Section */
        .upload-section { background: #3a3f47; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        input[type="file"] { margin-right: 10px; color: #ddd; }
        button { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        .btn-upload { background-color: #4caf50; color: white; }
        .btn-upload:disabled { background-color: #555; cursor: not-allowed; }
        .btn-ask { background-color: #2196f3; color: white; }

        /* Chat Window */
        .chat-window { background: #1c1e22; height: 400px; overflow-y: auto; padding: 20px; border-radius: 10px; border: 1px solid #444; display: flex; flex-direction: column; gap: 15px; }
        .message { padding: 10px 15px; border-radius: 10px; max-width: 80%; line-height: 1.4; }
        .user { align-self: flex-end; background-color: #4caf50; color: white; }
        .ai { align-self: flex-start; background-color: #3a3f47; color: #ddd; border: 1px solid #555; }
        .loading { font-style: italic; color: #888; align-self: center; }

        /* Input Area */
        .input-area { margin-top: 20px; display: flex; gap: 10px; }
        input[type="text"] { flex-grow: 1; padding: 12px; border-radius: 5px; border: none; outline: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Research RAG Assistant</h1>

        <div class="upload-section">
            <input type="file" id="pdfFile">
            <button class="btn-upload" onclick="uploadFile()">Upload & Index</button>
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="message ai">Hello! Upload a PDF research paper to get started.</div>
        </div>

        <div class="input-area">
            <input type="text" id="questionInput" placeholder="Ask a question about the paper..." onkeypress="handleEnter(event)">
            <button class="btn-ask" onclick="askQuestion()">Ask</button>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5000"; // Your Backend URL

        // 1. Upload Logic
        async function uploadFile() {
            const fileInput = document.getElementById('pdfFile');
            const file = fileInput.files[0];

            if (!file) {
                alert("Please select a file first!");
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            const btn = document.querySelector('.btn-upload');
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                const response = await fetch(`${API_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                alert(data.message || "Upload successful!");
            } catch (error) {
                console.error(error);
                alert("Error uploading file.");
            } finally {
                btn.innerText = "Upload & Index";
                btn.disabled = false;
            }
        }

        // 2. Ask Logic
        async function askQuestion() {
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            const chatWindow = document.getElementById('chatWindow');

            if (!question) return;

            // Add User Message
            addMessage(question, 'user');
            input.value = '';

            // Show Loading
            const loadingId = addMessage("Thinking...", 'loading');

            try {
                const response = await fetch(`${API_URL}/ask`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });
                const data = await response.json();
                
                // Remove loading and add AI response
                document.getElementById(loadingId).remove();
                addMessage(data.answer || data.error, 'ai');


            } catch (error) {
                document.getElementById(loadingId).remove();
                addMessage("Error connecting to server.", 'ai');
            }
        }

        // Helper: Add message to screen
        function addMessage(text, type) {
            const chatWindow = document.getElementById('chatWindow');
            const div = document.createElement('div');
            const id = Math.random().toString(36).substr(2, 9); // Random ID for removal later
            div.id = id;
            div.className = `message ${type}`;
            div.innerText = text;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight; // Auto scroll to bottom
            return id;
        }

        // Helper: Allow pressing "Enter" to send
        function handleEnter(e) {
            if (e.key === 'Enter') askQuestion();
        }
    </script>
</body>
</html>